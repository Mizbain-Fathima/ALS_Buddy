# File: RAG/rag_chain.lel.yml
name: rag_chain
type: chain
description: |
  Retrieval-Augmented Generation chain: accepts user input, retrieves relevant
  docs from Chroma vectorstore, constructs a prompt with memory & context, and
  invokes the LLM to generate a response.
inputs:
  - input: string
  - memory_context: string (optional)
steps:
  - id: retriever
    type: chroma_retriever
    params:
      persist_directory: "RAG/chroma_db"
      collection_name: "als_chunks"
      embedding_model: "sentence-transformers/all-MiniLM-L6-v2"
      top_k: 5
  - id: format_context
    type: prompt
    params:
      template: |
        You are an empathetic assistant for ALS-related questions. Use the
        context below to answer the user's question. Be concise, factual,
        and gently worded. Do not provide medical advice â€” recommend seeking
        professional help when appropriate.

        CONTEXT:
        {retrieved_docs}

        MEMORY:
        {memory_context}

        USER QUESTION:
        {input}
  - id: llm
    type: llm
    params:
      model: "tinyllama-1.1b-chat-v1.0"
      provider: "huggingface"
      temperature: 0.2
      max_tokens: 512
  - id: run_generation
    type: run
    input_map:
      retrieved_docs: retriever.documents
      input: input
      memory_context: memory_context
    output_map:
      answer: llm.output
outputs:
  - answer: string
