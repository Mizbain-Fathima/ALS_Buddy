# File: RAG/chatbot_with_memory.lel.yml
name: chatbot_with_memory
type: chain
description: |
  Conversation wrapper chain that manages memory (conversation buffer) and
  delegates retrieval + generation to rag_chain. Updates memory after response.
inputs:
  - input: string
  - session_id: string
steps:
  - id: load_memory
    type: memory_loader
    params:
      backend: "local"
      memory_path: "RAG/memory/"
      session_key: "{session_id}"
  - id: merge_context
    type: map
    params:
      expression: |
        {
          "input": input,
          "memory_context": load_memory.buffer
        }
  - id: call_rag
    type: chain_call
    params:
      chain: "rag_chain"
      inputs:
        input: input
        memory_context: load_memory.buffer
  - id: update_memory
    type: memory_updater
    params:
      backend: "local"
      memory_path: "RAG/memory/"
      session_key: "{session_id}"
      append: true
      content: |
        - user: {input}
        - bot: {call_rag.answer}
  - id: output
    type: run
    input_map:
      answer: call_rag.answer
outputs:
  - answer: string
